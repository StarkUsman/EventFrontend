<div class="container mt-5">
  <div *ngIf="stage === 1">
    <h3 class="mb-4">Stage 1: Reservation Details</h3>
    <form>
      <div class="mb-3">
        <label for="reservationName" class="form-label">Reservation Name</label>
        <input type="text" id="reservationName" class="form-control" [(ngModel)]="reservation.reservation_name" name="reservation_name">
      </div>
      <div class="mb-3">
        <label for="reserverName" class="form-label">Reserver Name</label>
        <input type="text" id="reserverName" class="form-control" [(ngModel)]="reservation.reserver_name" name="reserver_name">
      </div>
      <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <input type="text" id="description" class="form-control" [(ngModel)]="reservation.description" name="description">
      </div>
      <div class="mb-3">
        <label for="date" class="form-label">Date</label>
        <input type="date" id="date" class="form-control" [(ngModel)]="reservation.date" name="date">
      </div>
    </form>
    <button class="btn btn-primary" (click)="nextStage()" [disabled]="!isStage1Valid()">Next <i class="fa fa-arrow-right"></i></button>
  </div>

  <div *ngIf="stage === 2">
    <h3 class="mb-4">Stage 2: Select a Slot</h3>
    <div class="calendar">
      <div class="timeline">
        <div class="time-marker">Normal</div>
        <div class="time-marker">Luxury</div>
        <div class="time-marker">Premium</div>
      </div>
      <div class="days">
        <div *ngFor="let day of days; let i = index" class="day">
          <div class="date">
            <p class="date-day">{{ day }}</p>
          </div>
          <div class="events">
            <div class="event" *ngFor="let slotType of ['Normal', 'Luxury', 'Premium']">
              <div class="radio-container">
                <input type="radio" 
                  name="selected_slot" 
                  id="event-{{ slotType.toLowerCase() }}-{{ i }}-1" 
                  (change)="selectSlot({ day: day, type: slotType, slot: 1 })"
                  [disabled]="isSlotDisabled({ day: day, type: slotType, slot: 1 })"
                  >
                <label for="event-{{ slotType.toLowerCase() }}-{{ i }}-1">Slot 1</label>
                <input type="radio"
                  name="selected_slot"
                  id="event-{{ slotType.toLowerCase() }}-{{ i }}-2"
                  (change)="selectSlot({ day: day, type: slotType, slot: 2 })"
                  [disabled]="isSlotDisabled({ day: day, type: slotType, slot: 2 })">
                <label for="event-{{ slotType.toLowerCase() }}-{{ i }}-2">Slot 2</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <button class="btn btn-secondary" (click)="prevStage()"><i class="fa fa-arrow-left"></i> Back</button>
    <button class="btn btn-primary" (click)="nextStage()" [disabled]="!isStage2Valid()">Next <i class="fa fa-arrow-right"></i></button>
  </div>

  <div class="container mt-5">
    <!-- Stage 3: Select Menus -->
  <div *ngIf="stage === 3">
    <h3 class="mb-4">Stage 3: Select Menus</h3>
    <div class="row">
      <div class="col-md-4" *ngFor="let menu of availableMenus">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{{ menu.menu_name }}</h5>
            <p class="card-text"><strong>Description:</strong> {{ menu.description }}</p>
            <p class="card-text"><strong>Price:</strong> {{ menu.menu_price | currency }}</p>
            
            <ul>
              <li *ngFor="let item of menu.menu_items">
                <span>{{ item.item_name }} - {{ item.price | currency }}</span>
              </li>
            </ul>

            <!-- Radio button for menu selection -->
            <input type="radio" 
                  id="menu-{{ menu.menu_id }}" 
                  name="selectedMenu" 
                  [value]="menu" 
                  [(ngModel)]="reservation.selectedMenu" 
                  (change)="selectMenu(menu)" />
            <label for="menu-{{ menu.menu_id }}" class="btn btn-outline-primary">
              <i class="fa fa-check"></i> Select
            </label>
          </div>
        </div>
      </div>
    </div>

    <div class="mb-3">
      <label for="numPersons" class="form-label">Number of Persons</label>
      <input type="number" id="numPersons" class="form-control" [(ngModel)]="reservation.num_of_persons" name="num_of_persons" min="1">
    </div>

    <button class="btn btn-secondary" (click)="prevStage()"><i class="fa fa-arrow-left"></i> Back</button>
    <button class="btn btn-primary" (click)="nextStage()" [disabled]="!isStage3Valid()">Next <i class="fa fa-arrow-right"></i></button>
  </div>   
  
    <!-- Stage 4: Final Review -->
    <div *ngIf="stage === 4">
      <h3 class="mb-4">Stage 4: Final Review</h3>
      
      <!-- Display Selected Menu -->
      <div *ngIf="reservation.selectedMenu">
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="card-title">{{ reservation.selectedMenu.menu_name }}</h5>
            <p><strong>Price:</strong> {{ reservation.selectedMenu.menu_price | currency }}</p>
    
            <!-- Displaying selected menu items in a gallery grid -->
            <div class="menu-items-gallery">
              <div *ngFor="let item of menuItems" class="menu-item-card">
                <img [src]="item.imageUrl || 'default-image.jpg'" alt="{{ item.item_name }}" class="menu-item-img">
                <div class="menu-item-details">
                  <label class="menuItemLabel" for="item-{{ item.menu_item_id }}">
                    {{ item.item_name }}
                  </label>
                  <!-- Remove button for each selected item -->
                  <button *ngIf="item.selected" class="btn btn-danger btn-sm" (click)="removeMenuItem(item)">
                    <i class="fa fa-trash"></i> Remove Item
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    
      <!-- Display Additional Services Checklist -->
      <div class="mb-3">
        <h5 for="additionalServices" class="card-title">Additional Services</h5>
        <div class="menu-items-gallery">
          <div class="menu-item-card" *ngFor="let service of additionalServices">
            <div class="form-check">
              <input type="checkbox"
                     id="service-{{ service.additional_service_id }}"
                     class="form-check-input"
                     [(ngModel)]="service.selected"
                     (change)="updateAdditionalServices(service)">
              <label class="form-check-label menuItemLabel" for="service-{{ service.additional_service_id }}">
                {{ service.additional_service_name }} - {{ service.price | currency }}
              </label>
            </div>
          </div>
        </div>
      </div>
    
      <!-- Calculate and Display Total Price -->
      <div class="mb-3">
        <h5>Total Price</h5>
        <p><strong>Menu Price:</strong> {{ reservation.selectedMenu.menu_price | currency }}</p>
        <p><strong>Selected Items:</strong> 
          <span *ngFor="let item of reservation.selected_items; let isLast = last">
            {{ item.item_name }} - {{ item.price | currency }}<span *ngIf="!isLast">, </span>
          </span>
        </p>
    
        <p><strong>Additional Services:</strong> 
          <span *ngFor="let service of reservation.additional_services; let isLast = last">
            {{ service.additional_service_name }} - {{ service.price | currency }}<span *ngIf="!isLast">, </span>
          </span>
        </p>
        <h4><strong>Grand Total: {{ getGrandTotal() | currency }}</strong></h4>
      </div>
    
      <!-- Navigation Buttons -->
      <button class="btn btn-secondary" (click)="prevStage()">
        <i class="fa fa-arrow-left"></i> Back
      </button>
      <button class="btn btn-success" (click)="saveReservation()">
        Finish <i class="fa fa-check"></i>
      </button>
    </div>    